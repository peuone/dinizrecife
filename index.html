<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Óticas Diniz - Central de Atendimento</title>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #c4161c;
            --secondary-color: #FFFFFF;
            --hover-color: #a01217;
            --back-color: #6C757D;
            --text-color: #333333;
            --background-color: #F4F4F4;
            --white-text: #FFFFFF;
            --premium-color: #FFD700;
            --resina-color: #4CAF50;
            --policarbonato-color: #2196F3;
            --alto-indice-color: #9C27B0;
        }

        body {
            font-family: 'Open Sans', sans-serif;
            margin: 0;
            padding: 20px;
            background-color: var(--background-color);
            color: var(--text-color);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .header img {
            max-width: 200px;
            height: auto;
        }

        .options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .option-card {
            background: var(--secondary-color);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            text-align: center;
            border-left: 5px solid var(--primary-color);
            text-decoration: none;
            color: var(--text-color);
        }

        .option-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }

        .option-card img {
            width: 100%;
            max-width: 150px;
            height: auto;
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .option-card h4 {
            margin: 10px 0;
            color: var(--primary-color);
            font-size: 1.2em;
        }

        .option-card p {
            font-size: 0.9em;
            color: var(--text-color);
            line-height: 1.4;
            text-align: left;
        }

        .badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 3px;
            font-size: 0.8em;
            margin-right: 5px;
            font-weight: bold;
        }

        .resina-badge {
            background-color: var(--resina-color);
            color: white;
        }

        .policarbonato-badge {
            background-color: var(--policarbonato-color);
            color: white;
        }

        .alto-indice-badge {
            background-color: var(--alto-indice-color);
            color: white;
        }

        .navigation-buttons {
            text-align: center;
            margin-top: 30px;
        }

        button {
            background-color: var(--primary-color);
            color: var(--white-text);
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 0 10px;
            transition: background-color 0.3s;
            font-family: 'Open Sans', sans-serif;
            font-size: 1em;
        }

        .back-button {
            background-color: var(--back-color) !important;
        }

        button:hover {
            background-color: var(--hover-color);
        }

        .step {
            display: none;
        }

        .step.active {
            display: block;
        }

        .whatsapp-button {
            background-color: #25D366;
            color: white;
            padding: 15px 25px;
            border-radius: 5px;
            text-decoration: none;
            display: inline-block;
            margin-top: 20px;
            font-size: 1.1em;
            transition: background-color 0.3s;
        }

        .whatsapp-button:hover {
            background-color: #128C7E;
        }

        .footer {
            text-align: center;
            margin-top: 40px;
            color: var(--text-color);
            font-size: 0.9em;
        }

        .welcome-step {
            text-align: center;
        }

        .welcome-step input {
            padding: 10px;
            font-size: 1em;
            border-radius: 5px;
            border: 1px solid #ccc;
            margin-bottom: 20px;
            width: 80%;
            max-width: 300px;
        }

        .observations {
            margin-top: 20px;
        }

        .observations textarea {
            width: 100%;
            max-width: 500px;
            padding: 10px;
            font-size: 1em;
            border-radius: 5px;
            border: 1px solid #ccc;
            resize: vertical;
            min-height: 100px;
        }

        .lojas-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .loja-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .loja-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
            border-color: var(--primary-color);
        }

        .loja-card.selected {
            border-color: var(--primary-color);
            background-color: #fff0f0;
        }

        .loja-card img {
            width: 60px;
            height: 60px;
            object-fit: contain;
            margin-bottom: 10px;
        }

        .loja-card h4 {
            margin: 5px 0;
            color: var(--primary-color);
        }

        .loja-card p {
            margin: 5px 0;
            font-size: 0.8em;
            color: var(--text-color);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Página inicial estilo Linktree -->
        <div id="home-step" class="step active">
            <div class="header">
                <img src="https://github.com/user-attachments/assets/e352ef86-5b03-444d-adc0-8f83017dc053" alt="Logo Óticas Diniz">
                <h2>Central de Atendimento</h2>
                <p>Selecione a loja mais próxima ou inicie seu atendimento</p>
            </div>

            <div class="options-grid">
                <div class="option-card" onclick="navigateTo('welcome-step')">
                    <h4>Agende sua Consulta</h4>
                </div>
                
                <a href="https://wa.me/558198764207" class="option-card" target="_blank">
                    <h4>Shopping Recife</h4>
                </a>

                <a href="https://wa.me/558182770159" class="option-card" target="_blank">
                    <h4>Shopping Rio Mar</h4>
                </a>

                <a href="https://wa.me/558181422344" class="option-card" target="_blank">
                    <h4>Shopping Tacaruna</h4>
                </a>

                <a href="https://wa.me/558183020002" class="option-card" target="_blank">
                    <h4>Shopping Boa Vista</h4>
                </a>

                <a href="https://wa.me/558198764205" class="option-card" target="_blank">
                    <h4>Shopping Guararapes</h4>
                </a>

                <a href="https://wa.me/558185860948" class="option-card" target="_blank">
                    <h4>Diniz Mix Matheus Boa Viagem</h4>
                </a>

                <a href="https://wa.me/558187270002" class="option-card" target="_blank">
                    <h4>Diniz Mix Matheus Casa Forte</h4>
                </a>

            </div>
        </div>

        <!-- Página inicial do assistente -->
        <div id="welcome-step" class="step">
            <div class="header">
                <img src="https://github.com/user-attachments/assets/e352ef86-5b03-444d-adc0-8f83017dc053" alt="Logo Óticas Diniz">
                <h3>Bem-vindo ao Assistente Diniz</h3>
            </div>
            
            <div class="welcome-step">
                <input type="text" id="client-name" placeholder="Digite o nome do cliente">
                <div class="navigation-buttons">
                    <button onclick="startAtendimento()">Iniciar Atendimento</button>
                    <button class="back-button" onclick="navigateTo('home-step')">Voltar</button>
                </div>
            </div>
        </div>

        <!-- Passos da navegação -->
        <div id="step1" class="step"></div> <!-- Receita médica -->
        <div id="step2" class="step"></div> <!-- Agendar consulta -->
        <div id="step3" class="step"></div> <!-- Categoria de lentes -->
        <div id="step4" class="step"></div> <!-- Tipo de lente -->
        <div id="step5" class="step"></div> <!-- Versão ou Categoria Bifocal -->
        <div id="step6" class="step"></div> <!-- Índice de refração -->
        <div id="step7" class="step"></div> <!-- Fotossensível -->
        <div id="summary" class="step summary"></div> <!-- Resumo -->
    </div>

    <div class="campaign-banner" style="text-align: center; margin: 20px 0;">
    <img src="pictures/campanha.gif" alt="Promoção Especial" style="width: 100%; max-width: 600px; border-radius: 10px;">
</div>
    <div class="content">

<div class="footer">
    <footer style="text-align: center; padding: 10px; background-color: #f4f4f4; font-size: 14px;">
        <p>🚧 Em desenvolvimento por <strong>Pedro Rodrigues</strong> </p>
        <p>📩 Sugestões? Me chama no WhatsApp: <a href="https://wa.me/5581997665895" target="_blank">+55 81 99766-5895</a></p>
    </footer>
</div>

    <script>
        const options = {
            'visao-simples': {
                types: [
                    { name: 'Convencional', img: 'pictures/vsconvencional.png', desc: 'Lentes tradicionais com tecnologia básica.' },
                    { name: 'Digital', img: 'pictures/vsdigital.png', desc: 'Lentes com design digital para maior precisão.' },
                    { name: 'Freeform', img: 'pictures/vsfreeform.png', desc: 'Lentes personalizadas com tecnologia avançada.' }
                ],
                fotossensivel: ['Sim', 'Não'],
                antirreflexo: ['Sem Antirreflexo', 'Verde', 'Azul', 'Solar']
            },
            'multifocais': {
                types: [
                    { name: 'Convencional', img: 'pictures/convencional.png', desc: 'Lentes multifocais tradicionais.' },
                    { name: 'Digital', img: 'pictures/digital.png', desc: 'Multifocais com design digital.' },
                    { name: 'Freeform', img: 'pictures/freeform.png', desc: 'Multifocais personalizadas com tecnologia avançada.' }
                ],
                versions: [
                    { name: 'DMAX GO', img: 'pictures/dmaxgo.png', desc: 'Conforto e Nitidez com Preço Acessível' },
                    { name: 'DMAX LIGHT', img: 'pictures/dmaxlight.png', desc: 'Versatilidade, Fácil Adaptação e Equilíbrio entre os Campos' },
                    { name: 'DMAX SMART', img: 'pictures/dmaxsmart.png', desc: 'Distribuição Balanceada, Melhor Custo-benefício' },
                    { name: 'DMAX TOP', img: 'pictures/dmaxtop.png', desc: 'Conforto Superior, Alta Tecnologia, Nitidez Excelente' },
                    { name: 'DMAX INFINITY', img: 'pictures/dmaxinfinity.png', desc: 'Tecnologia de Ponta, Máxima Personalização' }
                ],
                fotossensivel: ['Sim', 'Não'],
                antirreflexo: {
                    'Convencional': ['Sem Antirreflexo', 'Verde', 'Azul', 'Solar'],
                    'Digital': ['Sem Antirreflexo', 'Verde', 'Azul', 'Solar'],
                    'Freeform': ['Sem Antirreflexo', 'Verde', 'Azul', 'Verde Premium', 'Azul Premium', 'Solar']
                }
            },
            'bifocais': {
                types: [
                    { name: 'Convencional', img: 'pictures/vsconvencional.png', desc: 'Lentes bifocais tradicionais.' },
                    { name: 'Digital', img: 'pictures/vsdigital.png', desc: 'Bifocais com design digital.' },
                    { name: 'Freeform', img: 'pictures/vsfreeform.png', desc: 'Bifocais personalizadas com tecnologia avançada.' }
                ],
                categories: ['Ultex', 'Panoptik', 'Kriptok', 'Executive'],
                fotossensivel: ['Sim', 'Não'],
                antirreflexo: ['Sem Antirreflexo', 'Verde', 'Azul', 'Solar']
            },
            'indice-refracao': [
                { 
                    name: 'Resinas Padrão (1.49, 1.50 e 1.56)', 
                    img: 'pictures/resina-padrao.png',
                    desc: 'Melhor custo-benefício, indicado para graus baixos (até ±3.00) e armações menores.<br><br>✅ Boa qualidade óptica<br>✅ Maior espessura em comparação com índices mais altos<br>✅ Opcionais de tratamento antirreflexo e proteção UV',
                    badgeClass: 'resina-badge'
                },
                { 
                    name: 'Policarbonato (1.59)', 
                    img: 'pictures/policarbonato.png',
                    desc: 'Ideal para crianças, esportes e uso diário com mais resistência.<br><br>✅ Alta resistência a impactos (mais seguro)<br>✅ Lente leve e confortável<br>✅ Proteção UV integrada',
                    badgeClass: 'policarbonato-badge'
                },
                { 
                    name: 'Resinas de Alto Índice (1.60, 1.61, 1.67, 1.74)', 
                    img: 'pictures/alto-indice.png',
                    desc: 'Recomendado para graus médios a altos (acima de ±3.00), proporcionando mais estética e conforto.<br><br>✅ Lentes mais finas e leves<br>✅ Melhor opção para armações maiores<br>✅ Proteção UV integrada',
                    badgeClass: 'alto-indice-badge'
                },
                { 
                    name: 'Obter Sugestão da Loja', 
                    img: 'pictures/sugestao-loja.png',
                    desc: 'Não tem certeza sobre a melhor opção? Nossa equipe pode recomendar a lente ideal com base no seu grau e armação!<br><br>✅ Avaliação personalizada<br>✅ Melhor equilíbrio entre estética e custo<br>✅ Escolha segura e recomendada por especialistas',
                    badgeClass: ''
                }
            ]
        };

        // Lista de lojas
        const lojas = [
            { nome: 'Shopping Recife', whatsapp: '8198764207', img: 'pictures/shopping-recife.png' },
            { nome: 'Shopping Rio Mar', whatsapp: '8182770159', img: 'pictures/rio-mar.png' },
            { nome: 'Shopping Tacaruna', whatsapp: '8181422344', img: 'pictures/tacaruna.png' },
            { nome: 'Shopping Boa Vista', whatsapp: '8183020002', img: 'pictures/boa-vista.png' },
            { nome: 'Shopping Guararapes', whatsapp: '8198764205', img: 'pictures/guararapes.png' },
            { nome: 'Diniz Mix Matheus Boa Viagem', whatsapp: '8185860948', img: 'pictures/matheus-bv.png' },
            { nome: 'Diniz Mix Matheus Casa Forte', whatsapp: '8187270002', img: 'pictures/matheus-cf.png' }
        ];

        let currentSelection = {
            category: '',
            type: '',
            versao: '',
            indiceRefracao: '',
            fotossensivel: '',
            antirreflexo: '',
            bifocalCategory: '',
            clientName: '',
            receitaMedica: '',
            selectedLoja: null
        };

        let currentStepHistory = ['home-step'];

        function navigateTo(stepId, fromHistory = false) {
            if (!fromHistory) currentStepHistory.push(stepId);
            document.querySelectorAll('.step').forEach(step => step.classList.remove('active'));
            document.getElementById(stepId).classList.add('active');
            window.scrollTo(0, 0);
        }

        function goBack() {
            if (currentStepHistory.length > 1) {
                currentStepHistory.pop();
                const prevStep = currentStepHistory[currentStepHistory.length - 1];
                navigateTo(prevStep, true);
            }
        }

        function startAtendimento() {
            const clientName = document.getElementById('client-name').value;
            if (!clientName) {
                alert('Por favor, insira o nome do cliente.');
                return;
            }
            currentSelection.clientName = clientName;
            showReceitaMedicaStep();
        }

        function showReceitaMedicaStep() {
            const step = document.getElementById('step1');
            step.innerHTML = `
                <h3>Você tem receita médica?</h3>
                <div class="options-grid">
                    <div class="option-card" onclick="selectReceitaMedica('Sim')">
                        <h4>Sim, tenho receita.</h4>
                        <p>Quero prosseguir com o assistente de lentes.</p>
                    </div>
                    <div class="option-card" onclick="selectReceitaMedica('Não')">
                        <h4>Não tenho receita médica.</h4>
                        <p>Gostaria de agendar uma consulta.</p>
                    </div>
                </div>
                <div class="navigation-buttons">
                    <button class="back-button" onclick="goBack()">Voltar</button>
                </div>
            `;
            navigateTo('step1');
        }

        function selectReceitaMedica(opt) {
            currentSelection.receitaMedica = opt;
            if (opt === 'Sim') {
                showCategorySelection();
            } else {
                showAgendarConsultaStep();
            }
        }

        function showAgendarConsultaStep() {
            const step = document.getElementById('step2');
            step.innerHTML = `
                <h3>Quer enviar para a loja sua sugestão de lentes?</h3>
                <div class="options-grid">
                    <div class="option-card" onclick="selectEnviarSugestao('Sim')">
                        <h4>Sim</h4>
                        <p>Quero enviar minha sugestão de lentes.</p>
                    </div>
                    <div class="option-card" onclick="selectEnviarSugestao('Não')">
                        <h4>Não</h4>
                        <p>Quero apenas agendar uma consulta.</p>
                    </div>
                </div>
                <div class="navigation-buttons">
                    <button class="back-button" onclick="goBack()">Voltar</button>
                </div>
            `;
            navigateTo('step2');
        }

        function selectEnviarSugestao(opt) {
            if (opt === 'Sim') {
                showCategorySelection();
            } else {
                showAgendamentoConsulta();
            }
        }

        function showAgendamentoConsulta() {
            const summary = document.getElementById('summary');
            const whatsappMessage = `Olá, gostaria de agendar uma consulta. Cliente: ${currentSelection.clientName}`;
            
            // Mostrar seleção de loja para agendamento
            summary.innerHTML = `
                <h3>Selecione a Loja para Agendamento:</h3>
                <div class="lojas-grid" id="lojas-container">
                    ${lojas.map(loja => `
                        <div class="loja-card" onclick="selectLoja(${lojas.indexOf(loja)})">
                            <img src="${loja.img}" alt="${loja.nome}">
                            <h4>${loja.nome}</h4>
                            <p>Clique para selecionar</p>
                        </div>
                    `).join('')}
                </div>
                <div class="navigation-buttons">
                    <button class="back-button" onclick="goBack()">Voltar</button>
                </div>
                <div id="whatsapp-button-container" style="display: none; text-align: center; margin-top: 20px;">
                    <a href="#" class="whatsapp-button" target="_blank" id="whatsapp-link">Agendar Consulta</a>
                </div>
            `;
            
            navigateTo('summary');
        }

        function selectLoja(index) {
            currentSelection.selectedLoja = lojas[index];
            
            // Remover seleção de todas as lojas
            document.querySelectorAll('.loja-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // Adicionar seleção à loja escolhida
            document.querySelectorAll('.loja-card')[index].classList.add('selected');
            
            // Atualizar link do WhatsApp
            const whatsappMessage = `Olá, gostaria de agendar uma consulta. Cliente: ${currentSelection.clientName}`;
            const whatsappLink = `https://wa.me/55${currentSelection.selectedLoja.whatsapp}?text=${encodeURIComponent(whatsappMessage)}`;
            
            document.getElementById('whatsapp-link').href = whatsappLink;
            document.getElementById('whatsapp-button-container').style.display = 'block';
        }

        function showCategorySelection() {
            const step3 = document.getElementById('step3');
            step3.innerHTML = `
                <h3>Selecione o Tipo de Lente:</h3>
                <div class="options-grid">
                    <div class="option-card" onclick="selectCategory('visao-simples')">
                        <img src="pictures/visao simples 2.png" alt="Visão Simples">
                        <h4>Visão Simples</h4>
                        <p>Lentes para correção de problemas de visão de perto ou longe.</p>
                    </div>
                    <div class="option-card" onclick="selectCategory('multifocais')">
                        <img src="pictures/multifocal2.png" alt="Multifocais">
                        <h4>Multifocais</h4>
                        <p>Lentes que corrigem visão de perto, intermediária e longe.</p>
                    </div>
                    <div class="option-card" onclick="selectCategory('bifocais')">
                        <img src="pictures/bifocal2.png" alt="Bifocais">
                        <h4>Bifocais</h4>
                        <p>Lentes com duas áreas de visão: perto e longe.</p>
                    </div>
                </div>
                <div class="navigation-buttons">
                    <button class="back-button" onclick="goBack()">Voltar</button>
                </div>
            `;
            navigateTo('step3');
        }

        function selectCategory(category) {
            currentSelection.category = category;
            showTypeSelection();
        }

        function showTypeSelection() {
            const step4 = document.getElementById('step4');
            const categoryData = options[currentSelection.category];
            step4.innerHTML = `
                <h3>Selecione o Tipo de ${currentSelection.category.replace('-', ' ').toUpperCase()}:</h3>
                <div class="options-grid">
                    ${categoryData.types.map(type => `
                        <div class="option-card" onclick="selectType('${type.name}')">
                            <img src="${type.img}" alt="${type.name}">
                            <h4>${type.name}</h4>
                            <p>${type.desc}</p>
                        </div>
                    `).join('')}
                </div>
                <div class="navigation-buttons">
                    <button class="back-button" onclick="goBack()">Voltar</button>
                </div>
            `;
            navigateTo('step4');
        }

        function selectType(type) {
            currentSelection.type = type;
            if (currentSelection.category === 'multifocais' && type === 'Freeform') {
                showVersionSelection();
            } else if (currentSelection.category === 'bifocais') {
                showBifocalCategorySelection();
            } else {
                showIndiceRefracaoSelection();
            }
        }

        function showVersionSelection() {
            const step5 = document.getElementById('step5');
            step5.innerHTML = `
                <h3>Selecione a Versão Freeform:</h3>
                <div class="options-grid">
                    ${options.multifocais.versions.map(version => `
                        <div class="option-card" onclick="selectVersion('${version.name}')">
                            <img src="${version.img}" alt="${version.name}">
                            <h4>${version.name}</h4>
                            <p>${version.desc}</p>
                        </div>
                    `).join('')}
                </div>
                <div class="navigation-buttons">
                    <button class="back-button" onclick="goBack()">Voltar</button>
                </div>
            `;
            navigateTo('step5');
        }

        function selectVersion(version) {
            currentSelection.versao = version;
            showIndiceRefracaoSelection();
        }

        function showBifocalCategorySelection() {
            const step5 = document.getElementById('step5');
            step5.innerHTML = `
                <h3>Selecione a Categoria de Bifocais:</h3>
                <div class="options-grid">
                    ${options.bifocais.categories.map(category => `
                        <div class="option-card" onclick="selectBifocalCategory('${category}')">
                            <img src="pictures/${category.toLowerCase()}.png" alt="${category}">
                            <h4>${category}</h4>
                        </div>
                    `).join('')}
                </div>
                <div class="navigation-buttons">
                    <button class="back-button" onclick="goBack()">Voltar</button>
                </div>
            `;
            navigateTo('step5');
        }

        function selectBifocalCategory(category) {
            currentSelection.bifocalCategory = category;
            showIndiceRefracaoSelection();
        }

        function showIndiceRefracaoSelection() {
            const step6 = document.getElementById('step6');
            step6.innerHTML = `
                <h3>Escolha o Índice de Refração:</h3>
                <div class="options-grid">
                    ${options['indice-refracao'].map(item => `
                        <div class="option-card" onclick="selectIndiceRefracao('${item.name}')">
                            ${item.badgeClass ? `<span class="badge ${item.badgeClass}">${item.name.split(' ')[0]}</span>` : ''}
                            <img src="${item.img}" alt="${item.name}">
                            <h4>${item.name}</h4>
                            <p>${item.desc}</p>
                        </div>
                    `).join('')}
                </div>
                <div class="navigation-buttons">
                    <button class="back-button" onclick="goBack()">Voltar</button>
                </div>
            `;
            navigateTo('step6');
        }

        function selectIndiceRefracao(indice) {
            currentSelection.indiceRefracao = indice;
            showFotossensivelSelection();
        }

        function showFotossensivelSelection() {
            const step7 = document.getElementById('step7');
            
            if (!options[currentSelection.category] || !options[currentSelection.category].fotossensivel) {
                console.error("Opções de fotossensível não definidas para esta categoria:", currentSelection.category);
                return;
            }

            step7.innerHTML = `
                <h3>Tratamento Fotossensível:</h3>
                <div class="options-grid">
                    ${options[currentSelection.category].fotossensivel.map(opt => `
                        <div class="option-card" onclick="selectFotossensivel('${opt}')">
                            <img src="${opt === 'Sim' ? 'pictures/fotossensivel-sim.png' : 'pictures/fotossensivel-nao.png'}" alt="${opt}">
                            <h4>${opt}</h4>
                            <p>${opt === 'Sim' ? 'Lentes que escurecem automaticamente ao sol.' : 'Lentes sem alteração ao sol.'}</p>
                        </div>
                    `).join('')}
                </div>
                <div class="navigation-buttons">
                    <button class="back-button" onclick="goBack()">Voltar</button>
                </div>
            `;
            navigateTo('step7');
        }

        function selectFotossensivel(opt) {
            currentSelection.fotossensivel = opt;
            showAntirreflexoSelection();
        }

        function showAntirreflexoSelection() {
            const summary = document.getElementById('summary');
            
            let antirreflexoOptions;
            if (currentSelection.category === 'multifocais') {
                antirreflexoOptions = options.multifocais.antirreflexo[currentSelection.type] || 
                                     options.multifocais.antirreflexo['Convencional'];
            } else {
                antirreflexoOptions = options[currentSelection.category].antirreflexo;
            }

            summary.innerHTML = `
                <h3>Tratamento Antirreflexo:</h3>
                <div class="options-grid">
                    ${antirreflexoOptions.map(opt => `
                        <div class="option-card" onclick="selectAntirreflexo('${opt}')">
                            <img src="${getAntirreflexoImage(opt)}" alt="${opt}">
                            <h4>${opt} ${opt.includes('Premium') ? '<span class="badge" style="background: var(--premium-color)">2 anos de garantia</span>' : ''}</h4>
                            <p>${getAntirreflexoDescription(opt)}</p>
                        </div>
                    `).join('')}
                </div>
                <div class="navigation-buttons">
                    <button class="back-button" onclick="goBack()">Voltar</button>
                </div>
            `;
            navigateTo('summary');
        }

        function getAntirreflexoImage(opt) {
            switch (opt) {
                case 'Verde': return 'pictures/arverde.png';
                case 'Azul': return 'pictures/arazul.png';
                case 'Solar': return 'pictures/antirreflexo-solar.png';
                case 'Verde Premium': return 'pictures/arverde.png';
                case 'Azul Premium': return 'pictures/arazul.png';
                case 'Sem Antirreflexo': return 'pictures/sem-antirreflexo.png';
                default: return 'pictures/default.png';
            }
        }

        function getAntirreflexoDescription(opt) {
            switch (opt) {
                case 'Sem Antirreflexo': return 'Sem tratamento adicional.';
                case 'Verde': return 'Proteção contra reflexos e luz intensa.';
                case 'Azul': return 'Proteção contra a luz azul nociva.';
                case 'Solar': return 'Lentes solares para proteção UV.';
                case 'Verde Premium': return 'Proteção premium com durabilidade de 2 anos.';
                case 'Azul Premium': return 'Proteção premium contra luz azul com 2 anos de garantia.';
                default: return 'Descrição não disponível.';
            }
        }

        function selectAntirreflexo(opt) {
            currentSelection.antirreflexo = opt;
            showFinalSummary();
        }

        function showFinalSummary() {
            const summary = document.getElementById('summary');
            let whatsappMessage = `*Pedido de Lentes - Óticas Diniz*\n\n`;
            whatsappMessage += `*Cliente:* ${currentSelection.clientName}\n`;
            whatsappMessage += `*Categoria:* ${currentSelection.category.replace('-', ' ').toUpperCase()}\n`;
            whatsappMessage += `*Tipo:* ${currentSelection.type}\n`;
            if (currentSelection.versao) whatsappMessage += `*Versão:* ${currentSelection.versao}\n`;
            if (currentSelection.bifocalCategory) whatsappMessage += `*Categoria Bifocal:* ${currentSelection.bifocalCategory}\n`;
            whatsappMessage += `*Índice de Refração:* ${currentSelection.indiceRefracao}\n`;
            whatsappMessage += `*Fotossensível:* ${currentSelection.fotossensivel}\n`;
            whatsappMessage += `*Antirreflexo:* ${currentSelection.antirreflexo}\n`;
            
            if (currentSelection.receitaMedica === 'Não') {
                whatsappMessage += `\n*Observação:* O cliente não possui receita médica e deseja agendar uma consulta.\n`;
            }

            const observations = document.getElementById('observations')?.value || '';
            if (observations) {
                whatsappMessage += `\n*Observações Adicionais:*\n${observations}\n`;
            }

            // Mostrar seleção de loja
            summary.innerHTML = `
                <h3>Resumo Final da Sua Escolha:</h3>
                <p><strong>Cliente:</strong> ${currentSelection.clientName}</p>
                <p><strong>Categoria:</strong> ${currentSelection.category.replace('-', ' ').toUpperCase()}</p>
                <p><strong>Tipo:</strong> ${currentSelection.type}</p>
                ${currentSelection.versao ? `<p><strong>Versão:</strong> ${currentSelection.versao}</p>` : ''}
                ${currentSelection.bifocalCategory ? `<p><strong>Categoria Bifocal:</strong> ${currentSelection.bifocalCategory}</p>` : ''}
                <p><strong>Índice de Refração:</strong> ${currentSelection.indiceRefracao}</p>
                <p><strong>Fotossensível:</strong> ${currentSelection.fotossensivel}</p>
                <p><strong>Antirreflexo:</strong> ${currentSelection.antirreflexo}</p>
                
                <div class="observations">
                    <label for="observations">Observações (opcional):</label>
                    <textarea id="observations" placeholder="Adicione observações, se necessário"></textarea>
                </div>

                <h3 style="margin-top: 30px;">Selecione a Loja para Enviar:</h3>
                <div class="lojas-grid" id="lojas-container">
                    ${lojas.map(loja => `
                        <div class="loja-card" onclick="selectLojaFinal(${lojas.indexOf(loja)})">
                            <img src="${loja.img}" alt="${loja.nome}">
                            <h4>${loja.nome}</h4>
                            <p>Clique para selecionar</p>
                        </div>
                    `).join('')}
                </div>

                <div class="navigation-buttons">
                    <button class="back-button" onclick="goBack()">Voltar</button>
                    <button onclick="init()">Reiniciar</button>
                </div>
                <div id="whatsapp-button-container" style="display: none; text-align: center; margin-top: 20px;">
                    <a href="#" class="whatsapp-button" target="_blank" id="whatsapp-link">Enviar Pedido para a Loja</a>
                </div>
            `;

            document.getElementById('observations').addEventListener('input', function() {
                const updatedMessage = whatsappMessage + (this.value ? `\n\n*Observações Adicionais:*\n${this.value}` : '');
                if (currentSelection.selectedLoja) {
                    document.getElementById('whatsapp-link').href = `https://wa.me/55${currentSelection.selectedLoja.whatsapp}?text=${encodeURIComponent(updatedMessage)}`;
                }
            });
        }

        function selectLojaFinal(index) {
            currentSelection.selectedLoja = lojas[index];
            
            // Remover seleção de todas as lojas
            document.querySelectorAll('.loja-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // Adicionar seleção à loja escolhida
            document.querySelectorAll('.loja-card')[index].classList.add('selected');
            
            // Atualizar link do WhatsApp
            let whatsappMessage = `*Pedido de Lentes - Óticas Diniz*\n\n`;
            whatsappMessage += `*Cliente:* ${currentSelection.clientName}\n`;
            whatsappMessage += `*Categoria:* ${currentSelection.category.replace('-', ' ').toUpperCase()}\n`;
            whatsappMessage += `*Tipo:* ${currentSelection.type}\n`;
            if (currentSelection.versao) whatsappMessage += `*Versão:* ${currentSelection.versao}\n`;
            if (currentSelection.bifocalCategory) whatsappMessage += `*Categoria Bifocal:* ${currentSelection.bifocalCategory}\n`;
            whatsappMessage += `*Índice de Refração:* ${currentSelection.indiceRefracao}\n`;
            whatsappMessage += `*Fotossensível:* ${currentSelection.fotossensivel}\n`;
            whatsappMessage += `*Antirreflexo:* ${currentSelection.antirreflexo}\n`;
            
            if (currentSelection.receitaMedica === 'Não') {
                whatsappMessage += `\n*Observação:* O cliente não possui receita médica e deseja agendar uma consulta.\n`;
            }

            const observations = document.getElementById('observations').value || '';
            if (observations) {
                whatsappMessage += `\n*Observações Adicionais:*\n${observations}\n`;
            }

            const whatsappLink = `https://wa.me/55${currentSelection.selectedLoja.whatsapp}?text=${encodeURIComponent(whatsappMessage)}`;
            
            document.getElementById('whatsapp-link').href = whatsappLink;
            document.getElementById('whatsapp-button-container').style.display = 'block';
        }

        function init() {
            currentSelection = {
                category: '',
                type: '',
                versao: '',
                indiceRefracao: '',
                fotossensivel: '',
                antirreflexo: '',
                bifocalCategory: '',
                clientName: '',
                receitaMedica: '',
                selectedLoja: null
            };
            currentStepHistory = ['home-step'];
            navigateTo('home-step');
        }

        // Inicializa o sistema
        init();
    </script>
</body>
</html>
